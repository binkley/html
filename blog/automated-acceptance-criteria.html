<!DOCTYPE html>
<html lang=en>
<head>
    <meta charset=utf-8>
    <title>Automated Acceptance Criteria</title>
    <link href='https://fonts.googleapis.com/css?family=Noto%20Sans'
          rel='stylesheet' type='text/css'>
    <style>
        body {
            font-family: 'Noto Sans', sans-serif;
        }

        aside {
            width: 25%;
        }

        dt {
            font-weight: bolder;
        }

        .todo {
            color: red;
            font-style: oblique;
            text-decoration: line-through;
        }

        .todo:before {
            content: 'TODO: '
        }

        .story-syntax {
            font-weight: bolder;
        }

        .message {
            font-style: oblique;
        }

        .trouble {
            color: red !important;
        }

        .missing .ac:before {
            content: '\1F637';
            font-size: larger;
            font-style: normal;
        }

        .missing {
            color: gray;
        }

        .untested .ac:before {
            content: '\1F636';
            font-size: larger;
            font-style: normal;
        }

        .untested {
        }

        .running .ac:before {
            content: '\1F60E';
            font-size: larger;
            font-style: normal;
        }

        .running {
            color: blue;
            font-style: oblique;
        }

        .passed .ac:before {
            content: '\1F600';
            font-size: larger;
            font-style: normal;
        }

        .passed {
            color: green;
        }

        .failed .ac:before {
            content: '\1F61E';
            font-size: larger;
            font-style: normal;
        }

        .failed {
            color: red;
        }

        .errored .ac:before {
            content: '\1F632';
            font-size: larger;
            font-style: normal;
        }

        .errored {
            color: orange;
        }

        .disabled .ac:before {
            content: '\1F634';
            font-size: larger;
            font-style: normal;
        }

        .disabled {
            color: gray;
        }

        .flex-container {
            display: flex;
            flex-flow: row wrap;
            justify-content: flex-start;
        }

        .flex-container form {
            display: inline;
        }

        .header {
            flex: 100%;
        }

        .flex-item {
            margin: 1em;
        }
    </style>
</head>
<body>
<header>
    <h1>Automated Acceptance Criteria</h1>
</header>
<article>
    <aside style="float: right">
        <p class="todo">Less fragile link for image</p>
        <img src="https://lh3.googleusercontent.com/-o6e5YUtj8rU/TWkVMlQbqGI/AAAAAAAAACo/OmiXddT-biE/s200/RalphWiggum4.gif"
             alt="Thoughtful Ralph Wiggum" style="float: right; width: 50%;
              height: auto"/>
        <blockquote>
            A well written user story helps put me into a thoughtful frame
            of mind.
        </blockquote>
    </aside>
    <section id="dream-story-card">
        <h2>I have a dream (story card)</h2>
        <p>What is my dream story card? I don't mean: <em>What's the story
            I'd most like to work on</em>! I mean:
            <em>What should a virtual story card look like</em> (as opposed
            to card stock on a wall)? This
            may be a trivial question. But for me the
            <strong>user experience</strong> working with stories is very
            important: I work with them daily, write them, discuss them,
            finish them, etc. I want the feel of the card to be
            <em>thoughtful</em>, like that fellow to the right.</p>
        <p>And more than that. I am lazy, impatient, hubristic. The
            <strong>acceptance criteria</strong>, I want them testable,
            literally testable in that each has a matching test I can
            execute. Given my laziness, I don't want to switch systems
            and run tests; I'd like to execute acceptance criteria directly
            from the story card.</p>
        <p>So is there a system like that today?  No.  There are bits and
            pieces though.</p>
    </section>
    <aside style="float:left">
        <img src="https://upload.wikimedia.org/wikipedia/en/1/14/Ralph_Wiggum.png"
             alt="Ralph Wiggum picking nose"
             style="float:left; width: 40%; height: auto"/>
        <blockquote>
            Difficult to use systems, waiting on tests, ugly interfaces,
            counter-intuitive controls: these are a few of my least
            favorite things.
        </blockquote>
    </aside>
    <section id="nightmare-story-card">
        <h2>Not all story card systems are equal</h2>
        <p>Some story card systems are particularly awkward to read,
            understand or use. Special demerits for:</p>
        <ul>
            <li>A hard-coded workflow that cannot be changed to fit the
                team: the team has to fit the tool
            </li>
            <li>Workflow state transition buttons are nice, but not so
                nice is unconfigurable labels, especially when the button
                labels are misleading
            </li>
            <li>A hard-coded or limited hierarchy of stories, so if a
                team uses <em>epics</em> or <em>features</em> or
                <em>themes</em> or whatever to organize stories and more
                than one level, they are out of luck
            </li>
            <li>Lack of quality RESTful support, in particular, no simple
                identifier for story cards, so linking directly to cards is
                opaque, useless or completely absent
            </li>
        </ul>
    </section>

    <section id="scenario">
        <h2>A scenario</h2>
        <p>Post-development testing on this team is a fairly ordinary role.
            The developers say a new web page is ready. Testers then
            validate the same page features each time for each new page,
            simple things:</p>
        <ul>
            <li>Can an account with security role <samp>X</samp> log in?</li>
            <li>Can <samp>X</samp> submit the form? (Or not submit if
                forbidden?)
            </li>
            <li>What page form defaults appear for role <samp>X</samp>? Do
                they reflect role <samp>X</samp>?
            </li>
        </ul>
        <p>(Yes, I know &mdash; what about developer testing? Bear with
            me.)</p>
        <p>On it goes, the same work each time. Redundant, repetitive,
            error-prone, fiddly. And worst of all&mdash;<em>boring</em>,
            <strong>BORING</strong>! This is traditional, manual "user
            testing" at its worst.</p>
        <p><em>What's to be done?</em> <em>Can we fix this?</em></p>
        <p>After all, the testing is valuable: nobody wants broken web pages;
            everybody wants to log in. But is this the <em>most</em> valuable
            testing a human could do? Surely people are more clever, more
            insightful than this. And what about all the other page
            features not tested because of time spent on the basics?</p>
        <p>Well, people are more clever than this.</p>
    </section>
    <section id="forward-path">
        <h2>A forward path</h2>
        <p class="todo">Better section title</p>
        <p>What guides testing? If you're using nearly any form of modern user
            story writing, this includes something like "Acceptance Criteria".
            These are the gates that permit story development to be called
            successful: the testers are gatekeepers <a
                    href="https://www.thoughtworks.com/insights/blog/how-we-eliminated-gatekeeper-quality">in
                the manual testing world</a>. In the manual world these
            criteria might be congregated into a single "Requirements
            Document" or similar (think: <a
                    href="https://en.wikipedia.org/wiki/Big_Design_Up_Front">big,
                upfront design</a>).</p>
        <p>We can do better! Gatekeeper-style testing assumes a linear path
            from requirements to implementation to testing, just as waterfall
            considers these activities as distinct phases. But we know
            agile approaches do better than waterfall in most (nearly all)
            cases. Why should we build our teams to mirror waterfall? Of
            course the answer is to structure teams to look agile, even as
            the team itself practices agile values.</p>
    </section>
    <section id="three-amigos">
        <h2>Enter the Three Amigos</h2>
    </section>
    <section id="acceptance-criteria">
        <h2>What are Acceptance Criteria?</h2>
        <p>But where does this simple testing come from? Any software delivery
            process beyond "winging it" has some requirements</p>
        <p>Well-written agile stories have Acceptance Criteria. What are
            these? An Acceptance Criteria (AC) is a statement in a story that
            a tester (QA) can use to validate that all or a portion of the
            story is complete. The formulaic phrasing for ACs I like best
            is:</p>
        <blockquote>
            <span class="story-syntax">GIVEN</span> <em>some state of the
            world</em><br>
            <span class="story-syntax">WHEN</span> <em>some change
            happens</em><br>
            <span class="story-syntax">THEN</span> <em>some observable
            outcome results</em>
        </blockquote>
        <p>Generally for web applications this means when I do something with
            a web page in the application, then the page changes in some
            particular way or submits a request and the response page has
            some particular quality or property (or the negative case that
            is does not have that quality or property).</p>
        <p>In some cases it is even simpler: just check that a particular web
            address fully loads, for example, when testing login access to
            pages.</p>
        <img
                src="http://martinfowler.com/bliki/images/testPyramid/test-pyramid.png"
                alt="Martin Fowler's Test Pyramid"
                style="float:right; width:35%; height:auto;">
        <h2>So what's the question?</h2>
        <p>Wherever possible we want to automate. If something can be done for
            us by a computing machine, we don't want to spend human time on
            it. Humans can move on to more interesting, valuable work when
            existing tasks can be automated.</p>
        <p>Consider the Test Pyramid (<em>image right</em>): automating
            lower-value tests focuses people on higher-value ones. You get
            more human attention and insight on the kinds of tests which best
            improve the value of software. You win more.</p>
    </section>
    <section id="story-picture">
        <p class="todo">Too prologue before the main event.</p>
        <h2>A picture of a story</h2>
        <p>This is a sample story card with a simplistic implementation of
            AACs. Live buttons call back into the story system, to be
            mapped to calls in the testing system. (Another
            implementation might have the buttons directly call to the
            testing system, avoiding an extra call into the story system
            but showing details in the page source about the testing
            system.)</p>
        <blockquote>
            <section>
                <h3>Title</h3>
                <h4></h4>
                <h3>Narrative</h3>
                <p><span class="story-syntax">AS A</span> AAC author<br>
                    <span class="story-syntax">I WANT</span> a mock executable
                    story<br>
                    <span class="story-syntax">SO THAT</span> others can see
                    the value</p>
            </section>
            <section>
                <h3>Details</h3>
                <p>No actual criteria were validated in the execution of
                    these tests. This is only a mock.</p>
            </section>
            <section class="flex-container">
                <h3 class="header">
                    <form action="/test-all">
                        <button>Test All</button>
                    </form>
                    Acceptance criteria
                </h3>
                <div class="header"><strong>Summary:</strong>
                    <span class="missing">1 missing</span>,
                    <span class="untested">1 untested</span>,
                    <span class="running">1 running</span>,
                    <span class="passed">1 passed</span>,
                    <span class="failed">1 failed</span>,
                    <span class="errored">1 errored</span>,
                    <span class="disabled">1 disabled</span></div>
                <div class="flex-item missing">
                    <div>
                        <form
                                action="/create-test/ThisProduct/ThisStory/AC1?given=magical+thinking&when=in+Missingland&then=there's+no+test"
                                method="PUT">
                            <button><em>Create</em></button>
                        </form>
                        <span class="ac">
                            <span class="story-syntax">GIVEN</span> magical thinking<br>
                            <span class="story-syntax">WHEN</span> in Missingland<br>
                            <span class="story-syntax">THEN</span> there's no test
                        </span>
                    </div>
                    <div class="message trouble">No test (yet) - <em>create
                        one!</em></div>
                </div>
                <div class="flex-item untested">
                    <div>
                        <form
                                action="/run-test/ThisProduct/ThisStory/AC2">
                            <button>Test</button>
                        </form>
                        <span class="ac">
                            <span class="story-syntax">GIVEN</span> magical thinking<br>
                            <span class="story-syntax">WHEN</span> in Newland<br>
                            <span class="story-syntax">THEN</span> nothing has happened yet
                        </span>
                    </div>
                    <div class="message trouble">Test never run - <em>be the
                        first!</em></div>
                </div>
                <div class="flex-item running">
                    <div>
                        <form
                                action="/tests-in-progress/ThisProduct/ThisStory/AC3"
                                method="DELETE">
                            <button>Cancel</button>
                        </form>
                        <span class="ac">
                            <span class="story-syntax">GIVEN</span> magical thinking<br>
                            <span class="story-syntax">WHEN</span> in Fastland<br>
                            <span class="story-syntax">THEN</span> tests run quickly
                        </span>
                    </div>
                    <div class="message">15% done (3s)</div>
                </div>
                <div class="flex-item passed">
                    <div>
                        <form
                                action="/run-test/ThisProduct/ThisStory/AC4">
                            <button>Test</button>
                        </form>
                        <span class="ac">
                            <span class="story-syntax">GIVEN</span> magical thinking<br>
                            <span class="story-syntax">WHEN</span> in Happyland<br>
                            <span class="story-syntax">THEN</span> Unicorns
                        </span>
                    </div>
                </div>
                <div class="flex-item failed">
                    <div>
                        <form
                                action="/run-test/ThisProduct/ThisStory/AC5">
                            <button>Test</button>
                        </form>
                        <span class="ac">
                            <span class="story-syntax">GIVEN</span> magical thinking<br>
                            <span class="story-syntax">WHEN</span> in Sadland<br>
                            <span class="story-syntax">THEN</span> there be Dragons
                        </span>
                    </div>
                    <div class="message trouble">Expected:
                        <em>Dragons</em>, got: <em>Puppies</em></div>
                </div>
                <div class="flex-item errored">
                    <div>
                        <form
                                action="/run-test/ThisProduct/ThisStory/AC6">
                            <button>Test</button>
                        </form>
                        <span class="ac">
                            <span class="story-syntax">GIVEN</span> magical thinking<br>
                            <span class="story-syntax">WHEN</span> in Crazyland<br>
                            <span class="story-syntax">THEN</span> nothing works right
                        </span>
                    </div>
                    <div class="message trouble">Test timed out
                        after 90 seconds
                    </div>
                </div>
                <div class="flex-item disabled">
                    <div>
                        <button disabled>Disabled</button>
                        <span class="ac">
                            <span class="story-syntax">GIVEN</span> magical thinking<br>
                            <span class="story-syntax">WHEN</span> in Slowland<br>
                            <span class="story-syntax">THEN</span> tests are disabled
                        </span>
                    </div>
                    <div class="message trouble">@dev1 @qa2: BLOCKED on
                        widget spanner
                    </div>
                </div>
            </section>
        </blockquote>
    </section>
    <section id="ac-states">
        <h2>Acceptance Criteria states</h2>
        <p>Every AC potentially has a message from the testing system
            giving more detail on state. These are noted below.</p>
        <dl>
            <dt>Missing</dt>
            <dd>
                <p>This AC has no matching test in the testing system. Use
                    the <em>Create</em> button to create a new test. This does
                    not run the test.</p>
                <p>The <em>message</em> is boilerplate to remind users to
                    create tests.</p>
            </dd>
            <dt>Untested</dt>
            <dd>
                <p>The AC has a matching test in the testing system, but the
                    test has never been run. Use the <em>Test</em> button to
                    run the test.</p>
                <p>Typically there is no <em>message</em> for this state.</p>
            </dd>
            <dt>Running</dt>
            <dd>
                <p>The matching test for the AC is running in the testing
                    system. Use the <em>Cancel</em> button to stop the test,
                    or wait for it to complete.</p>
                <p>The <em>message</em>, is supported by the testing
                    system, should give a notion of progress. See <a
                            href="http://farazdagi.com/blog/2014/rest-long-running-jobs/"><cite>REST
                        and long-running jobs</cite></a> for how to do this.
                </p>
            </dd>
            <dt>Passed</dt>
            <dd>
                <p>The matching test for the AC passed last time it ran.
                    Use the <em>Test</em> button to run the test again.</p>
                <p>Typically there is no <em>message</em> for this state.</p>
            </dd>
            <dt>Failed</dt>
            <dd>
                <p>The matching test for the AC failed last time it ran.
                    Use the <em>Test</em> button to run the test again.</p>
                <p>The <em>message</em> must give a notion of why the test
                    failed.</p>
            </dd>
            <dt>Errored</dt>
            <dd>
                <p>The matching test for the AC errored last time it ran.
                    Use the <em>Test</em> button to run the test again.</p>
                <p>The <em>message</em> must give a notion of why the test
                    errored.</p>
            </dd>
            <dt>Disabled</dt>
            <dd>
                <p>The matching test for the AC is disabled in the testing
                    system. Update the testing system to reenable.</p>
                <p>The <em>message</em>, if supported, should give a
                    reason the test is disabled when available.</p>
            </dd>
        </dl>
    </section>
    <section id="problems">
        <h2>Potential problems</h2>
        <p>Nothing is free. Potential problems with AACs include:</p>
        <dl>
            <dt>Integrations</dt>
            <dd>
                <p>There are no existing
                    integrations along these lines. You need to build your
                    own against JIRA, Mingle, FitNesse, Cucumber, etc. Whether
                    the story system drives the interaction, or the test
                    system does, may depend on the exact combination. Best
                    would be if both systems can call the other.</p></dd>
            <dt>Scaling</dt>
            <dd>
                <p>As more AACs run, the complete suite takes longer. For
                    example, adding 1 minute of AAC/story, and 5
                    stories/iteration, in a 12 iteration project takes 60
                    minutes to run. This is not specific to AACs but a
                    general problem with acceptance tests. It's still much
                    cheaper than the manual steps for each test, but
                    prohibitive for a developer to run the whole suite
                    locally.</p>
                <p><em>Best practice</em> is for the 3 amigos to run only
                    the tests specific to a story before calling that story
                    <em>Ready to Accept</em>.</p></dd>
        </dl>
    </section>
    <section id="implementation">
        <h2>Possible implementations</h2>
        <h3>General</h3>
        <ul class="todo">
            <li>REST between test system &amp; card wall</li>
            <li>Create is an interesting case &mdash; how feasible is it
                to interact with the testing system &amp; use some kind
                of template to generate a new test case?
            </li>
            <li>Live bidi: Test button in story kicks off test via REST;
                edits in test update story via REST
            </li>
            <li>A given test can only be run once at a time; no parallel runs
                of the same test.  A live story card may show a test
                changing to <em>running</em> from <em>runnable</em> when
                another user kicks off the test from elsewhere
            </li>
        </ul>
        <h3>FitNesse</h3>
        <p>FitNesse is a mature acceptance testing system built as a wiki
            with executable pages and an extension system.</p>
        <ul class="todo">
            <li>Convention over configuration: test named by
                camel-catenating words in AC
            </li>
            <li>Convention over configuration: test page named by
                camel-catenting story title
            </li>
            <li>Can we do 1 test table/AC (hence 1 page per story), or
                would it be 1 AC/page and a story is a suite?
            </li>
        </ul>
    </section>
    <section id="rest-api">
        <h2>Sample REST API</h2>
        <ul class="todo">
            <li>Terrible, horrible, no good un-RESTful API.</li>
            <li>Swagger for documenting API</li>
            <li><code>POST</code> best for actions?</li>
            <li>Use long-running REST API for running tests (which do not
                have to be fast! Think Cucumber)</li>
        </ul>
        <h3>Calling the story system</h3>
        <h4>From the story page</h4>
        <dl>
            <dt><code>GET</code>, <code>POST</code>
                <code>/test-all</code></dt>
            <dd>
                <p>Invokes all tests for this story in the testing system,
                    and updates the story page with progress and results.</p>
                <h5>Parameters</h5>
                <dl>
                    <dt>story</dt>
                    <dd>The unique mapping identifying a story.</dd>
                </dl>
            </dd>
            <dt><code>GET</code> <code>/tests/<var>id</var></code></dt>
            <dd>
                <p>Gets the status of <var>id</var> test, including:
                    <ul>
                        <li>Most recent test result (pass, fail, etc.)</li>
                        <li>Current state (running, stopped, etc.)</li>
                    </ul>
                </p>
            </dd>
            </dt>
            <dt><code>PUT</code> <code>/create-test</code></dt>
            <dd>
                <p>Creates a new test in the testing system for an AC, and
                    marks the AC as runnable.</p>
                <h5>Parameters</h5>
                <dl>
                    <dt>story</dt>
                    <dd>The unique mapping identifying a story</dd>
                    <dt>given</dt>
                    <dd>The <em>GIVEN</em> clause of the AC</dd>
                    <dt>when</dt>
                    <dd>The <em>WHEN</em> clause of the AC</dd>
                    <dt>then</dt>
                    <dd>The <em>THEN</em> clause of the AC</dd>
                </dl>
            </dd>
            <dt><code>GET</code>, <code>POST</code>
                <code>/run-test</code></dt>
            <dd>
                <p>Runs the test in the testing system for an AC, and marks
                    the AC as running. When the testing system finishes, marks
                    the AC with disabled, passed, failed or errored.</p>
                <h5>Parameters</h5>
                <dl>
                    <dt>story</dt>
                    <dd>The unique mapping identifying a story</dd>
                    <dt>given</dt>
                    <dd>The <em>GIVEN</em> clause of the AC</dd>
                    <dt>when</dt>
                    <dd>The <em>WHEN</em> clause of the AC</dd>
                    <dt>then</dt>
                    <dd>The <em>THEN</em> clause of the AC</dd>
                </dl>
            </dd>
            <dt><code>GET</code>
                <code>/tests-in-progress/<var>id</var></code></dt>
            <dd>
                <p>Gets the status of a currently running test.</p>
            </dd>
            <dt><code>DELETE</code>
                <code>/tests-in-progress/<var>id</var></code></dt>
           <dd>
                <p>Cancels the running test in the testing system for an AC,
                    and marks the AC as runnable.</p>
            </dd>
        </dl>
        <h4>From the testing system</h4>
        <dl>
            <dt><code>/new-test</code></dt>
            <dd>Notifies the story system of a new test potentially
                associated with an AC.
            </dd>
            <dt><code>/test-done</code></dt>
            <dd>Notifies the story system of test state for a test
                potentially associated with an AC.
            </dd>
        </dl>
        <h3>Calling the testing system</h3>
    </section>
</article>
</body>
